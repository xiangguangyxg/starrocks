-- name: test_flat_json_consistency2
-- array paired with selected mixed types for path level1.level2.level3.4

-- case 01: array -> int
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}'),
(2, '{"level1": {"level2": {"level3": {"4": 23234982794}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 02: array -> double
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}'),
(2, '{"level1": {"level2": {"level3": {"4": 3.14}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 03: array -> string
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}'),
(2, '{"level1": {"level2": {"level3": {"4": "abc"}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 04: array -> object
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}'),
(2, '{"level1": {"level2": {"level3": {"4": {"5":"abc"}}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 05: array -> empty_object
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}'),
(2, '{"level1": {"level2": {"level3": {"4": {}}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 06: array -> null_value
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}'),
(2, '{"level1": {"level2": {"level3": {"4": null}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 07: array -> json_null
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}'),
(2, NULL);

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 08: int -> array
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": 23234982794}}}}'),
(2, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 09: double -> array
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": 3.14}}}}'),
(2, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 10: string -> array
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": "abc"}}}}'),
(2, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 11: object -> array
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": {"5":"abc"}}}}}'),
(2, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 12: empty_object -> array
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": {}}}}}'),
(2, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 13: null_value -> array
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, '{"level1": {"level2": {"level3": {"4": null}}}}'),
(2, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

-- case 14: json_null -> array
drop table if exists test_json;
create table test_json (c1 int, c2 json)
distributed by random buckets 1
properties("flat_json.enable"="true");

insert into test_json values
(1, NULL),
(2, '{"level1": {"level2": {"level3": {"4": ["abc", 100, 200]}}}}');

select * from test_json order by c1;
select flat_json_meta(c2) from test_json [_META_];

